# 作用域和原型

## 作用域和作用域链

每个JavaScript函数都是`Function`对象的一个实例，其内部属性`[[Scope]]`包含了一个函数被创建的作用域中对象的集合，这个集合就成为函数的作用域链。

作用域链的第一个对象是当前代码所在环境的变量对象。

函数的执行会创建执行环境，多次执行函数会创造多个执行环境，每个执行环境有自己的作用域链，函数执行完毕时执行环境被销毁。通常，执行环境作用域链的顶端为活动对象，包含这所有局部变量、命名参数、参数集合以及`this`。

### 全局作用域

全局作用域中包括：

* 程序最外层定义的变量或函数

  ```javascript
  let count = 2;
  function hello(){
      console.log("hello")
  }
  ```

* 未定义直接赋值的变量

  ```javascript
  function fun(){
      a = 5;
  }
  
  console.log(a) // 可以访问到a
  console.log(b) // error
  ```

* `window`对象的所有属性和方法

  ```javascript
  console.log(window.location)
  ```

### 局部作用域

函数作用域

## 原型和原型链

*整理自[MDN|继承与原型链](<https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain>)*

每个实例对象（ object ）都有一个私有属性（称之为 __proto__ ）指向它的构造函数的原型对象（**prototype** ）。该原型对象也有一个自己的原型对象( __proto__ ) ，层层向上直到一个对象的原型对象为 `null`。根据定义，`null` 没有原型，并作为这个**原型链**中的最后一个环节。

### 基于原型链的继承

#### 继承属性

JavaScript 对象是动态的属性“包”（指其自己的属性）。JavaScript 对象有一个指向一个原型对象的链。当试图访问一个对象的属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及该对象的原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链的末尾。

#### 继承方法

当继承的函数被调用时，this 指向的是当前继承的对象，而不是继承的函数所在的原型对象。

```javascript
var o = {
  a: 2,
  m: function(){
    return this.a + 1;
  }
};

console.log(o.m()); // 3
// 当调用 o.m 时，'this' 指向了 o.

var p = Object.create(o);
// p是一个继承自 o 的对象

p.a = 4; // 创建 p 的自身属性 'a'
console.log(p.m()); // 5
// 调用 p.m 时，'this' 指向了 p
// 又因为 p 继承了 o 的 m 函数
// 所以，此时的 'this.a' 即 p.a，就是 p 的自身属性 'a'
```

### 原型链

![原型链图示](https://github.com/ch4zzzzz/FrontendKnowledge/raw/master/js/高性能JavaScript/原型链.jpg)